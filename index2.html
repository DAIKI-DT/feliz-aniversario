<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>ðŸ’• Jogo de Sintonia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { background: linear-gradient(135deg, #ffb6c1, #ffe6ec); min-height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Poppins', sans-serif; }
    .card { border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.15); padding: 30px; border: none; max-width: 450px; width: 90%; }
    .btn-love { background-color: #ff4d6d; color: white; border-radius: 30px; padding: 12px; border: none; font-weight: bold; transition: 0.3s; }
    .btn-love:hover { background-color: #e63e5c; transform: translateY(-2px); }
    .btn-choice { border-radius: 15px; padding: 15px; font-weight: 600; font-size: 1.1rem; }
    #pergunta { font-size: 1.4rem; font-weight: bold; color: #444; min-height: 80px; display: flex; align-items: center; justify-content: center; }
    .badge-sala { background: rgba(255, 77, 109, 0.1); color: #ff4d6d; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
  </style>
</head>
<body>

<div class="card text-center">
  <h2 class="mb-4">ðŸ’• Sintonia do Casal</h2>

  <div id="lobby">
    <p class="text-muted">Cria uma sala e envia o cÃ³digo para o teu amor!</p>
    <button id="btnCriar" class="btn btn-love w-100 mb-3 shadow-sm">Criar Nova Sala</button>
    <hr>
    <input id="codigoSala" class="form-control text-center mb-2" placeholder="Introduzir CÃ³digo" style="border-radius: 15px; padding: 10px;">
    <button id="btnEntrar" class="btn btn-outline-secondary w-100" style="border-radius: 30px;">Entrar na Sala</button>
  </div>

  <div id="sala" class="d-none">
    <div class="mb-3"><span class="badge-sala">SALA: <span id="codigo"></span></span></div>
    
    <div id="pergunta" class="mb-4 text-center">A carregar pergunta...</div>

    <div id="botoes-resposta" class="d-grid gap-3 mb-4">
      <button class="btn btn-success btn-choice" onclick="responder('Sim')">ðŸ’– SIM</button>
      <button class="btn btn-danger btn-choice" onclick="responder('NÃ£o')">ðŸ’” NÃƒO</button>
    </div>

    <div id="resultado" class="alert d-none animate__animated animate__fadeIn"></div>

    <button id="btnProxima" class="btn btn-love w-100 d-none">PrÃ³xima Pergunta âž¡</button>
    <p id="espera" class="small text-muted mt-2 d-none">Aguardando resposta do parceiro...</p>
  </div>
</div>

<script>
  let db, auth, userId, salaId;
  let perguntaAtual = 0;

  // Perguntas adaptadas para respostas Sim/NÃ£o
  const perguntas = [
    "Dormir de conchinha Ã© melhor que dormir com espaÃ§o?",
    "Quem se apaixonou primeiro fui eu?",
    "Eu sou a pessoa mais romÃ¢ntica da relaÃ§Ã£o?",
    "O nosso primeiro beijo foi melhor do que eu imaginava?",
    "Tu aceitas fugir comigo para uma ilha deserta agora?",
    "Achas que o nosso destino jÃ¡ estava traÃ§ado?",
    "Eu sou o teu porto seguro nos dias difÃ­ceis?"
  ];

  document.addEventListener("DOMContentLoaded", () => {
    const firebaseConfig = {
      apiKey: "AIzaSyBLj_hnopDlydVJmcrkx1ll436XYc7gFA0",
      authDomain: "jogo-casal-64b3b.firebaseapp.com",
      projectId: "jogo-casal-64b3b"
    };

    firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();

    auth.signInAnonymously().then(res => userId = res.user.uid);

    document.getElementById("btnCriar").onclick = criarSala;
    document.getElementById("btnEntrar").onclick = entrarSala;
    document.getElementById("btnProxima").onclick = proximaPergunta;
  });

  function criarSala() {
    if(!userId) return;
    salaId = Math.random().toString(36).substring(2, 6).toUpperCase();
    db.collection("salas").doc(salaId).set({
      perguntaAtual: 0,
      respostas: {},
      jogadores: [userId]
    }).then(() => { entrarUI(); ouvirSala(); });
  }

  function entrarSala() {
    salaId = document.getElementById("codigoSala").value.toUpperCase();
    if(!salaId) return alert("Cade o cÃ³digo?");
    
    const ref = db.collection("salas").doc(salaId);
    ref.get().then(doc => {
      if (!doc.exists) return alert("Sala nÃ£o encontrada!");
      ref.update({ jogadores: firebase.firestore.FieldValue.arrayUnion(userId) });
      entrarUI();
      ouvirSala();
    });
  }

  function entrarUI() {
    document.getElementById("lobby").classList.add("d-none");
    document.getElementById("sala").classList.remove("d-none");
    document.getElementById("codigo").innerText = salaId;
  }

  function ouvirSala() {
    db.collection("salas").doc(salaId).onSnapshot(doc => {
      const data = doc.data();
      if(!data) return;

      perguntaAtual = data.perguntaAtual;
      const perguntaTexto = perguntas[perguntaAtual] || "Fim do Jogo! â¤ï¸";
      document.getElementById("pergunta").innerText = perguntaTexto;

      if (perguntaAtual >= perguntas.length) {
        document.getElementById("botoes-resposta").classList.add("d-none");
        document.getElementById("btnProxima").classList.add("d-none");
        return;
      }

      const resps = data.respostas?.[perguntaAtual] || {};
      const ids = Object.keys(resps);
      
      // LÃ³gica de exibiÃ§Ã£o de resultados
      if (ids.length === 2) {
        document.getElementById("botoes-resposta").classList.add("d-none");
        document.getElementById("espera").classList.add("d-none");
        const resElement = document.getElementById("resultado");
        resElement.classList.remove("d-none");
        
        if (resps[ids[0]] === resps[ids[1]]) {
          resElement.className = "alert alert-success";
          resElement.innerText = "Sintonia Total! Ambos disseram " + resps[ids[0]] + "! âœ¨";
        } else {
          resElement.className = "alert alert-warning";
          resElement.innerText = "Ops! OpiniÃµes diferentes aqui... ðŸ¤”";
        }
        document.getElementById("btnProxima").classList.remove("d-none");
      } else {
        document.getElementById("resultado").classList.add("d-none");
        document.getElementById("btnProxima").classList.add("d-none");
        document.getElementById("botoes-resposta").classList.remove("d-none");
        
        // Se o usuÃ¡rio jÃ¡ respondeu mas o outro nÃ£o
        if (resps[userId]) {
            document.getElementById("botoes-resposta").classList.add("d-none");
            document.getElementById("espera").classList.remove("d-none");
        }
      }
    });
  }

  window.responder = function(valor) {
    db.collection("salas").doc(salaId).update({
      [`respostas.${perguntaAtual}.${userId}`]: valor
    });
  }

  function proximaPergunta() {
    db.collection("salas").doc(salaId).update({
      perguntaAtual: firebase.firestore.FieldValue.increment(1)
    });
  }
</script>
</body>
</html>